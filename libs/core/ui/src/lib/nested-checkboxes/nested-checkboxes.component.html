<core-tree
  [node]="item"
  [getId]="getId"
  [getChildren]="getChildren"
  [template]="checkbox"
></core-tree>

<ng-template
  #checkbox
  let-item
  let-level="level"
  let-parent="level > 0"
>
  <core-checkbox
    class="checkbox"
    [indeterminate]="indeterminates.includes(getId(item))"
    [class.checkbox--top]="!parent"
    [class.checkbox--indeterminate]="indeterminates.includes(getId(item))"
    [class.checkbox--checked]="model.includes(getId(item))"
    [class.checkbox--unchecked]="!model.includes(getId(item)) && !indeterminates.includes(getId(item))"
    [style.margin-left.px]="level * indentation"
    data-test="ui-nested-checkboxes-checkbox"
    [ngModel]="model.includes(getId(item))"
    (ngModelChange)="onChange($event, item)"
  >
    <ng-container
      [ngTemplateOutlet]="itemTemplate ? itemTemplate : defaultTemplate"
      [ngTemplateOutletContext]="{
        $implicit: item,
        parent: parent
      }"
    ></ng-container>
  </core-checkbox>
</ng-template>

<ng-template #defaultTemplate let-item>
  {{ this.getId(item) }}
</ng-template>
