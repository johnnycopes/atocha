<core-checkbox-tree-new
  [item]="item"
  [getId]="getId"
  [getChildren]="getChildren"
  [treeTemplate]="image"
  [itemTemplate]="checkbox"
  [indentation]="indentation"
  [size]="size"
  [ngModel]="model"
  (ngModelChange)="onChange($event)"
></core-checkbox-tree-new>

<ng-template #image let-item let-level="level" let-parent="parent">
  <ng-container *ngIf="treeTemplate"
    [ngTemplateOutlet]="treeTemplate"
    [ngTemplateOutletContext]="{
      $implicit: item,
      level: level,
      parent: parent,
      selected: selectedCounts[getId(item)],
      total: totalCounts[getId(item)]
    }"
  ></ng-container>
</ng-template>

<ng-template #checkbox let-item let-level="level" let-parent="parent">
  <ng-container
    [ngTemplateOutlet]="itemTemplate ? itemTemplate : defaultTemplate"
    [ngTemplateOutletContext]="{
      $implicit: item,
      level: level,
      parent: parent,
      selected: selectedCounts[getId(item)],
      total: totalCounts[getId(item)]
    }"
  ></ng-container>
</ng-template>

<ng-template
  #defaultTemplate
  let-item
  let-selected="selected"
  let-total="total"
>
  {{ getId(item) }}
  ({{
    getChildren(item).length
      ? selected + ' / ' + total
      : total
  }})
</ng-template>
