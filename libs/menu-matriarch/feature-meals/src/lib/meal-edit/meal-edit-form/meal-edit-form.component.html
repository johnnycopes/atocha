<form *ngIf="vm"
  #form="ngForm"
  (keydown.enter)="$event.preventDefault()"
  (ngSubmit)="onSave(form)"
>
  <app-dishes-list class="dishes"
    ngModelGroup="dishes"
  >
    <ui-card *appDishDef="let dish">
      <ui-dish-summary
        [id]="dish.id"
        [name]="dish.name"
        [description]="dish.description"
        [link]="dish.link"
        [tags]="dish.tags"
        [menuIds]="dish.menuIds"
        [mealIds]="dish.mealIds"
        [usages]="dish.usages"
        (nameClick)="onDishClick($event)"
      ></ui-dish-summary>
      <core-checkbox class="included"
        [name]="dish.id"
        [ngModel]="vm.dishesModel.includes(dish.id)"
        (ngModelChange)="onDishChange(form.value.dishes)"
      >
        Include in meal
      </core-checkbox>
    </ui-card>
  </app-dishes-list>

  <ui-section>
    <div class="ui-section__toolbar">
      <a core-button="secondary"
        class="button"
        routerLink=".."
      >
        Cancel
      </a>
      <button core-button
        class="button"
        type="submit"
        [disabled]="!form.valid || !vm.dishesModel.length"
      >
        Save
      </button>
    </div>
    <div class="ui-section__content">
      <ui-input class="input"
        label="name"
      >
        <input
          id="name"
          type="text"
          name="name"
          required
          [ngModel]="vm.name"
          #name="ngModel"
          coreAutofocus
        />
      </ui-input>
      <ui-input class="input"
        label="description"
      >
        <input
          id="description"
          type="text"
          name="description"
          [ngModel]="vm.description"
          #description="ngModel"
        />
      </ui-input>
      <ui-input class="input"
        label="tags"
      >
        <ui-tags-list
          *ngIf="vm.tags.length; else noTagsPlaceholder"
          class="tags"
          ngModelGroup="tags"
          [tags]="vm.tags"
          [interactive]="true"
        >
          <ng-container *uiTagDef="let tag">
            <core-checkbox
              [name]="tag.id"
              [ngModel]="tag.checked"
            >
              <ui-tag
                [id]="tag.id"
                [name]="tag.name"
              ></ui-tag>
            </core-checkbox>
          </ng-container>
        </ui-tags-list>
        <ng-template #noTagsPlaceholder>
          <div class="placeholder">
            <p>No tags to display</p>
            <a core-button
              class="button"
              routerLink="/tags"
            >
              New Tag
            </a>
          </div>
        </ng-template>
      </ui-input>
      <div class="details">
        <ui-meal-summary
          [dishes]="vm.dishes"
          [fallbackText]="vm.fallbackText"
          [orientation]="vm.orientation"
          (dishClick)="onDishClick($event)"
          boundaries="labeled"
        ></ui-meal-summary>
      </div>
    </div>
  </ui-section>
</form>
