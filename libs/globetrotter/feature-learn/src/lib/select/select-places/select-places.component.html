<ui-small-caps header="Places">
  <div class="regions">
    <core-counted-checkbox-tree-new *ngIf="tree"
      class="places"
      [node]="tree"
      [getId]="getId"
      [getChildren]="getChildren"
      [getLeafNodeCount]="getNumberOfCountries"
      [template]="label"
      size="large"
      [ngModel]="places"
      (ngModelChange)="onPlacesChange($event)"
    ></core-counted-checkbox-tree-new>
  </div>
</ui-small-caps>

<ng-template
  #label
  let-node
  let-level="level"
  let-checked="checked"
  let-indeterminate="indeterminate"
  let-onChange="onChange"
  let-selected="selected"
  let-total="total"
>
  <ng-container [ngSwitch]="level">
    <div *ngSwitchCase="0"
      class="top"
    >
      <div class="top__counter">
        <span class="bold">
          {{ selected }} / {{ total }}
        </span>
        possible countries in the cards.
      </div>

      <div class="top__buttons">
        <button core-button="secondary"
          class="top__select-all"
          (click)="onSelectAll()"
        >
          Select all
        </button>
        <button core-button="secondary"
          class="top__clear-all"
          (click)="onClearAll()"
        >
          Clear all
        </button>
      </div>
    </div>

    <ng-container *ngSwitchCase="1">
      <ui-icon *ngIf="level === 1"
        class="image"
        [icon]="getId(node)"
        [highlighted]="!!selected"
      ></ui-icon>

      <core-checkbox class="checkbox"
        [indeterminate]="indeterminate"
        size="large"
        [ngModel]="checked"
        (ngModelChange)="onChange($event, node)"
      >
        {{ this.getId(node) }}
        ({{
          this.getChildren(node).length
            ? selected + ' / ' + total
            : total
        }})
      </core-checkbox>
    </ng-container>

    <core-checkbox *ngSwitchCase="2"
      class="checkbox"
      [indeterminate]="indeterminate"
      size="large"
      [ngModel]="checked"
      (ngModelChange)="onChange($event, node)"
    >
      {{ getId(node) }} ({{ total }})
    </core-checkbox>
  </ng-container>
</ng-template>
